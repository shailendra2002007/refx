sap.ui.define(["sap/ui/base/Object","sap/m/MessageBox","sap/m/FormattedText","sap/m/Dialog","sap/m/Button","sap/m/ObjectStatus","sap/m/VBox","sap/m/SelectList","sap/ui/core/ListItem"],function(e,o,t,r,s,n,i,a,l){"use strict";return e.extend("dewa.refx.accommodation.controller.ErrorHandler",{constructor:function(e){this._oResourceBundle=e.getModel("i18n").getResourceBundle();this._oComponent=e;this._oModel=e.getModel();this._bMessageOpen=false;this._sErrorText=this._oResourceBundle.getText("errorText");this._oModel.attachMetadataFailed(function(e){var o=e.getParameters();this._showServiceError(o.response)},this);this._oModel.attachRequestFailed(function(e){var o=e.getParameters();if(o.response.statusCode!=="404"||o.response.statusCode===404&&o.response.responseText.indexOf("Cannot POST")===0){this._showServiceError(o.response)}},this)},_showServiceError:function(e){try{sap.ui.getCore().byId(this._oComponent.getId()+"---worklist").getController().closeBusyDialog()}catch(e){jQuery.sap.log.error(e)}try{sap.ui.getCore().byId(this._oComponent.getId()+"---inboxView").getController().closeBusyDialog()}catch(e){jQuery.sap.log.error(e)}if(typeof this._oComponent._bMessageOpen==="boolean"){this._bMessageOpen=this._oComponent._bMessageOpen}if(this._bMessageOpen){return}this._bMessageOpen=true;this._oComponent._bMessageOpen=this._bMessageOpen;try{if(JSON.parse(e.responseText).error.innererror.errordetails.length>0){var t=new r({state:"Error",type:"Message",title:"Sorry, An error occured.",icon:"sap-icon://error",beforeClose:function(e){this._bMessageOpen=false;this._oComponent._bMessageOpen=false;if(e.getParameters().origin===null){e.getSource(0)._bOpenAfterClose=true}}.bind(this),content:new i({items:[new a({showSecondaryValues:true,items:{path:"errorModel>/errordetails",template:new l({key:"{errorModel>code}",text:"{errorModel>message}",icon:"sap-icon://add-product"})}})]}),endButton:new s({text:"Ok",press:function(e){this._bMessageOpen=false;e.getSource().getParent().close();try{sap.ui.getCore().byId(this._oComponent.getId()+"---worklist").getController().closeBusyDialog()}catch(e){jQuery.sap.log.error(e)}try{sap.ui.getCore().byId(this._oComponent.getId()+"---inboxView").getController().closeBusyDialog()}catch(e){jQuery.sap.log.error(e)}try{this._oComponent._oViews._oComponent._oViews._oComponent.getRouter().navTo("inbox")}catch(e){jQuery.sap.log.error(e)}try{sap.ui.getCore().byId(this._oComponent.getId()+"---inboxView").getController().onInboxPatternMatched()}catch(e){jQuery.sap.log.error(e)}}.bind(this)})}).setModel(new sap.ui.model.json.JSONModel(JSON.parse(e.responseText).error.innererror),"errorModel");try{var n=/Android|iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;if(n===true&&window.navigator.notification&&window.navigator.notification.sendLog){window.navigator.notification.sendLog("REFX_UI_ACCOMM::ERROR::"+e.responseText+"::"+"",null,"","")}}catch{}t.open()}else{throw"Exception"}}catch(t){try{sap.ui.getCore().byId(this._oComponent.getId()+"---worklist").getController().closeBusyDialog()}catch(e){jQuery.sap.log.error(e)}try{sap.ui.getCore().byId(this._oComponent.getId()+"---inboxView").getController().closeBusyDialog()}catch(e){jQuery.sap.log.error(e)}o.error(this._sErrorText,{id:"serviceErrorMessageBox",details:e,styleClass:this._oComponent.getContentDensityClass(),actions:[o.Action.CLOSE],onClose:function(){try{this._oComponent._oViews._oComponent._oViews._oComponent.getRouter().navTo("inbox")}catch(e){jQuery.sap.log.error(e)}try{sap.ui.getCore().byId(this._oComponent.getId()+"---inbox").getController().onInboxPatternMatched()}catch(e){jQuery.sap.log.error(e)}this._bMessageOpen=false;this._oComponent._bMessageOpen=false}.bind(this)})}}})});